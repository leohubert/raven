"use strict";const l=require("electron");require("fs");const N=require("child_process"),D=require("os"),t=require("path");function V(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var S={},W=function(s){return s.map(function(r){return r&&typeof r=="object"?r.op.replace(/(.)/g,"\\$1"):/["\s]/.test(r)&&!/'/.test(r)?"'"+r.replace(/(['\\])/g,"\\$1")+"'":/["'\s]/.test(r)?'"'+r.replace(/(["\\$`!])/g,"\\$1")+'"':String(r).replace(/([A-Za-z]:)?([#!"$&'()*,:;<=>?@[\\\]^`{|}])/g,"$1\\$2")}).join(" ")},C="(?:"+["\\|\\|","\\&\\&",";;","\\|\\&","\\<\\(","\\<\\<\\<",">>",">\\&","<\\&","[&;()|<>]"].join("|")+")",B=new RegExp("^"+C+"$"),_="|&;()<> \\t",Q='"((\\\\"|[^"])*?)"',L="'((\\\\'|[^'])*?)'",U=/^#$/,k="'",P='"',$="$",y="",G=4294967296;for(var T=0;T<4;T++)y+=(G*Math.random()).toString(16);var J=new RegExp("^"+y);function z(e,s){for(var r=s.lastIndex,n=[],f;f=s.exec(e);)n.push(f),s.lastIndex===f.index&&(s.lastIndex+=1);return s.lastIndex=r,n}function F(e,s,r){var n=typeof e=="function"?e(r):e[r];return typeof n>"u"&&r!=""?n="":typeof n>"u"&&(n="$"),typeof n=="object"?s+y+JSON.stringify(n)+y:s+n}function H(e,s,r){r||(r={});var n=r.escape||"\\",f="(\\"+n+`['"`+_+`]|[^\\s'"`+_+"])+",u=new RegExp(["("+C+")","("+f+"|"+Q+"|"+L+")+"].join("|"),"g"),d=z(e,u);if(d.length===0)return[];s||(s={});var v=!1;return d.map(function(g){var i=g[0];if(!i||v)return;if(B.test(i))return{op:i};var w=!1,E=!1,p="",j=!1,o;function q(){o+=1;var h,b,x=i.charAt(o);if(x==="{"){if(o+=1,i.charAt(o)==="}")throw new Error("Bad substitution: "+i.slice(o-2,o+1));if(h=i.indexOf("}",o),h<0)throw new Error("Bad substitution: "+i.slice(o));b=i.slice(o,h),o=h}else if(/[*@#?$!_-]/.test(x))b=x,o+=1;else{var O=i.slice(o);h=O.match(/[^\w\d_]/),h?(b=O.slice(0,h.index),o+=h.index-1):(b=O,o=i.length)}return F(s,"",b)}for(o=0;o<i.length;o++){var a=i.charAt(o);if(j=j||!w&&(a==="*"||a==="?"),E)p+=a,E=!1;else if(w)a===w?w=!1:w==k?p+=a:a===n?(o+=1,a=i.charAt(o),a===P||a===n||a===$?p+=a:p+=n+a):a===$?p+=q():p+=a;else if(a===P||a===k)w=a;else{if(B.test(a))return{op:i};if(U.test(a)){v=!0;var A={comment:e.slice(g.index+o+1)};return p.length?[p,A]:[A]}else a===n?E=!0:a===$?p+=q():p+=a}}return j?{op:"glob",pattern:p}:p}).reduce(function(g,i){return typeof i>"u"?g:g.concat(i)},[])}var K=function(s,r,n){var f=H(s,r,n);return typeof r!="function"?f:f.reduce(function(u,d){if(typeof d=="object")return u.concat(d);var v=d.split(RegExp("("+y+".*?"+y+")","g"));return v.length===1?u.concat(v[0]):u.concat(v.filter(Boolean).map(function(g){return J.test(g)?JSON.parse(g.split(y)[1]):g}))},[])};S.quote=W;S.parse=K;var Z=N.execSync,X=D.platform(),Y=S.quote,ee=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.apply(arguments),s=null;return e.some(function(r){if(re(ne(r)))return s=r,!0}),s};function re(e){try{return Z(Y(e.split(" ")),{stdio:"ignore"}),!0}catch{return!1}}function ne(e){return/^win/.test(X)?"where "+e:"command -v "+e}var se=ee,te=N.spawn,ae=["mplayer","afplay","mpg123","mpg321","play","omxplayer","aplay","cmdmp3","cvlc","powershell"];function oe(e){e=e||{},this.players=e.players||ae,this.player=e.player||se(this.players),this.urlRegex=/^(https?|ftp):\/\/[^\s\/$.?#].[^\s]*$/i,this.play=function(s,r,n){if(n=n||function(){},n=typeof r=="function"?r:n,r=typeof r=="object"?r:{},r.stdio="ignore",this.player=="mplayer"&&this.urlRegex.test(s),!s)return n(new Error("No audio file specified"));if(!this.player)return n(new Error("Couldn't find a suitable audio player"));var f=Array.isArray(r[this.player])?r[this.player].concat(s):[s],u=te(this.player,f,r);return u?(u.on("close",function(d){n(d&&!d.killed?d:null)}),u):(n(new Error("Unable to spawn process with "+this.player)),null)},this.test=function(s){this.play("./assets/test.mp3",s)}}var ie=function(e){return new oe(e)};const le=V(ie),ue=le(),m=t.resolve(__dirname,"../../"),c=l.app.isPackaged?t.resolve(__dirname,"../../"):"";console.log(t.join(m,"assets/leo/sounds/foo.m4a"));const fe="`1234567890-=qwertyuiop[]asdfghjkl;'zxcvbnm,./~!@#$%^&*()_QWERTYUIOPASDFGHJKL:\"ZXCVBNM<>?".split(""),R=[{person:"leo",sounds:[t.join(m,"assets/leo/sounds/foo.m4a")],images:[t.join(c,"assets/leo/images/happy-leo.png")]},{person:"gael",sounds:[t.join(m,"assets/gael/sounds/kraaa.m4a")],images:[t.join(c,"assets/gael/images/edgael.png"),t.join(c,"assets/gael/images/gael-phoque-yeah.png"),t.join(c,"assets/gael/images/bunny-gael.png")]},{person:"guillaume",sounds:[t.join(m,"assets/guillaume/sounds/mouette.m4a")],images:[t.join(c,"assets/guillaume/images/pasto-santa.png")]},{person:"manu",sounds:[t.join(m,"assets/manu/sounds/turtle.m4a")],images:[t.join(c,"assets/manu/images/bunny-manu.png"),t.join(c,"assets/manu/images/manium.gif")]},{person:"seb",sounds:[t.join(m,"assets/seb/sounds/seb-pouet.m4a")],images:[t.join(c,"assets/seb/images/french-seb.png"),t.join(c,"assets/seb/images/seb-round.png")]},{person:"grace",sounds:[t.join(m,"assets/grace/sounds/ya-grace.m4a")],images:[t.join(c,"assets/grace/images/grace-slayy.png")]},{person:"nikan",sounds:[t.join(m,"assets/nikan/sounds/cat.m4a")],images:[t.join(c,"assets/nikan/images/porshe.png")]}];let I=null;function pe(){let e;do e=R[Math.floor(Math.random()*R.length)];while(e===I);return I=e,e}function ce(e){return e.sounds[Math.floor(Math.random()*e.sounds.length)]}function de(e){const s=pe(),r=ce(s);let n=l.screen.getCursorScreenPoint();e.forEach(f=>{let u=f.getBounds();u.x<=n.x&&n.x<=u.x+u.width&&u.y<=n.y&&n.y<=u.y+u.height&&f.webContents.send("sound",s.images)}),ue.play(r,function(f){f&&(l.dialog.showErrorBox("Error","Error playing sound"),l.app.quit())})}const M=()=>{let e=[],s=l.screen.getAllDisplays();for(const r of s){const n=new l.BrowserWindow({x:r.bounds.x,y:r.bounds.y,width:r.bounds.width,height:r.bounds.height,transparent:!0,frame:!1,hasShadow:!1,titleBarStyle:"hidden",titleBarOverlay:!0,alwaysOnTop:!0,skipTaskbar:!0,enableLargerThanScreen:!0,webPreferences:{preload:t.join(__dirname,"preload.js"),nodeIntegration:!0}});n.setHiddenInMissionControl(!0),n.setWindowButtonVisibility(!1),n.setAlwaysOnTop(!0,"screen-saver"),n.setVisibleOnAllWorkspaces(!0,{visibleOnFullScreen:!0}),n.setIgnoreMouseEvents(!0),n.loadFile(t.join(__dirname,"../renderer/main_window/index.html")),e.push(n)}return e};l.app.whenReady().then(async()=>{const e=M();l.globalShortcut.register("OPTION+Q",()=>{l.app.quit()}),l.globalShortcut.register("OPTION+V",()=>{l.dialog.showErrorBox("Version","Version: "+l.app.getVersion())}),l.globalShortcut.register("OPTION+D",()=>{e.forEach(s=>{s.webContents.openDevTools()})});for(const s of fe)try{l.globalShortcut.register(s,()=>{try{de(e)}catch(r){l.dialog.showErrorBox("Error",r.message),l.app.quit()}})}catch(r){console.log("Error registering key",s,r.message)}l.app.on("activate",()=>{l.BrowserWindow.getAllWindows().length===0&&M()})});
